#!/usr/bin/python3

import sqlite3
import time

HOUR = 3600
DAY = 86400
WEEK = 604800

UPDATE_INTERVAL = HOUR # Default is every hour.

def get_time_range(epoch):
    current_epoch = epoch
    lower_epoch = current_epoch + (3600 - current_epoch % UPDATE_INTERVAL)
    upper_epoch = lower_epoch + UPDATE_INTERVAL
    return lower_epoch, upper_epoch

current_epoch = int(time.time())
lower_epoch, upper_epoch = get_time_range(current_epoch)

time_intervals = [DAY, WEEK, 2 * WEEK]

conn = sqlite3.connect('test.db')
c = conn.cursor()

programs = []

for record in c.execute("SELECT * FROM Programs;"):
     programs.append(record[0])

with open("open_programs", "r") as file:
    open_programs = file.readlines()
    
for program in programs:

    if "\'" + program + "\'" in open_programs:
        continue

    earliest_log = c.execute("SELECT * FROM ProgramLogs WHERE ProgramLogs.ProgramName='" + program + "' ORDER BY DateTime ASC Limit 1;")
    earliest_epoch = earliest_log[-2]

    for interval in time_intervals:
        lower_log_epoch, upper_log_epoch = get_time_range(earliest_epoch)

        while upper_log_epoch < current_epoch:
            c.execute("SELECT * ")
